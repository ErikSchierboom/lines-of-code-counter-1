# Exercism's Lines of Code Counter

![Tests](https://github.com/exercism/lines-of-code-counter/workflows/Test/badge.svg)

This is Exercism's Lines of Code (LoC) Counter.
It takes a solution and counts its lines of code.

## Implementation

By default, we'll only count LoC in the files the student submitted.
Should the student also submit one of the test files, we'll ignore those.

While this works well for almost any submission, it doesn't work for older solutions that used a different test naming scheme.
TODO: expand

- Old solutions which files were named differently
- Solutions where the student added additional files

Therefore, each track can define a track-specific configuration to allow counting LoC in non-solution files.

## Track-specific configuration

To override the default configuration, each track can define a config file named `<slug>.include` inside the `tracks` directory (e.g. [`tracks/csharp.include`](./tracks/csharp.include)).
This config file defines the rules for which files to include when counting LoC for that track.
The include files can use the same globbing [syntax](https://git-scm.com/docs/gitignore) as `.gitignore` files, except that the include file works the other way around: you indicate which files to include (excluding is done via the `!` prefix).

To exclude the old test files from the LoC count, we can append the following line to the F# track's configuration file:

```gitignore
!*Test.fs
```

## Run the Lines of Code Counter

To count the lines of code of an arbitrary solution, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run.sh <track-slug> <exercise-slug> <solution-dir> <output-dir>`

Once the test runner has finished, its results will be written to `<output-dir>/response.json`.

## Run the Lines of Code Counter on a solution using Docker

_This script is provided for testing purposes, as it mimics how the Lines of Code Counter runs in Exercism's production environment._

To count the lines of code of an arbitrary solution using the Docker image, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-in-docker.sh <track-slug> <exercise-slug> <solution-dir> <output-dir>`

Once the test runner has finished, its results will be written to `<output-dir>/response.json`.

## Run the tests

To run the tests to verify the behavior of the Lines of Code Counter, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-tests.sh`

These are [golden tests][golden] that compare the `response.json` generated by running the current state of the code against the "known good" `tests/<test-name>/response.json`. All files created during the test run itself are discarded.

When you've made modifications to the code that will result in a new "golden" state, you'll need to generate and commit a new `tests/<test-name>/response.json` file.

## Run the tests using Docker

_This script is provided for testing purposes, as it mimics how the Lines of Code Counter runs in Exercism's production environment._

To run the tests to verify the behavior of the test runner using the Docker image, do the following:

1. Open a terminal in the project's root
2. Run `./bin/run-tests-in-docker.sh`

These are [golden tests][golden] that compare the `response.json` generated by running the current state of the code against the "known good" `tests/<test-name>/response.json`. All files created during the test run itself are discarded.

When you've made modifications to the code that will result in a new "golden" state, you'll need to generate and commit a new `tests/<test-name>/response.json` file.

## Credit

This repo is built and maintained by Exercism.

Contributions are welcome!

The actual counting of the LoC is done using the [tokei](https://github.com/XAMPPRocky/tokei) tool, which is both extremely fast and [supports many languages](https://github.com/XAMPPRocky/tokei#supported-languages).

[test-runners]: https://github.com/exercism/automated-tests/blob/master/docs/introduction.md
[golden]: https://ro-che.info/articles/2017-12-04-golden-tests
[exercism]: https://exercism.io
